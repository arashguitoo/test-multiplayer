<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ Wer √ºberlebt? - Konnektoren</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,#0f0c29 0%,#302b63 50%,#24243e 100%);min-height:100vh;color:#fff}.container{max-width:900px;margin:0 auto;padding:15px}h1{text-align:center;font-size:1.4em;margin-bottom:15px}#login-screen{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:85vh;gap:15px}.logo{font-size:3.5em}#login-screen h2{font-size:1.1em;color:#ffd700;text-align:center}.input-group{display:flex;flex-direction:column;gap:10px;width:100%;max-width:300px}.input-group input{font-size:1.1em;padding:12px 20px;border:2px solid #ffd700;border-radius:25px;text-align:center;background:rgba(255,255,255,.1);color:#fff}.input-group input::placeholder{color:rgba(255,255,255,.5)}.input-group input.code-input{font-size:1.4em;letter-spacing:8px;text-transform:uppercase}.btn-primary{font-size:1.1em;padding:15px 40px;border:none;border-radius:30px;background:linear-gradient(135deg,#00b894,#00cec9);color:#fff;font-weight:700;cursor:pointer;width:100%;max-width:300px}.btn-secondary{font-size:1em;padding:12px 30px;border:2px solid #ffd700;border-radius:25px;background:0 0;color:#ffd700;cursor:pointer;width:100%;max-width:300px}.divider{display:flex;align-items:center;gap:15px;width:100%;max-width:300px;margin:5px 0}.divider::before,.divider::after{content:'';flex:1;height:1px;background:rgba(255,255,255,.3)}.divider span{color:#888}#lobby-screen{display:none;text-align:center}.lobby-box{background:rgba(255,255,255,.1);border-radius:20px;padding:25px;margin:20px 0}.lobby-code{font-size:2.5em;color:#ffd700;letter-spacing:10px;margin:10px 0}.waiting-players{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin:20px 0;min-height:50px}.waiting-player{padding:10px 15px;background:rgba(255,215,0,.2);border-radius:20px;border:1px solid rgba(255,215,0,.5);display:flex;align-items:center;gap:8px}.waiting-player .remove-btn{background:rgba(255,0,0,.4);border:none;color:#fff;width:22px;height:22px;border-radius:50%;cursor:pointer;font-size:11px}.start-game-btn{font-size:1.2em;padding:15px 50px;border:none;border-radius:30px;background:linear-gradient(135deg,#00b894,#00cec9);color:#fff;font-weight:700;cursor:pointer;margin:15px 0}.start-game-btn:disabled{opacity:.5;cursor:not-allowed}.small-btn{font-size:.85em;padding:8px 15px;border:1px solid rgba(255,255,255,.3);border-radius:15px;background:0 0;color:#aaa;cursor:pointer;margin:5px}.small-btn.danger{border-color:#e74c3c;color:#e74c3c}#game-screen{display:none}.game-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;padding:12px 15px;background:rgba(255,255,255,.1);border-radius:15px;flex-wrap:wrap;gap:10px}.player-info{display:flex;align-items:center;gap:10px}.player-name{font-weight:700;color:#ffd700}.lives{font-size:1.2em}.timer{font-size:2em;font-weight:700;color:#00cec9;min-width:50px;text-align:center}.timer.warning{color:#fdcb6e}.timer.danger{color:#e74c3c;animation:pulse .5s infinite}@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}.question-num{color:#ffd700}.survivors{font-size:.85em;color:#00cec9}.quiz-section{background:rgba(255,255,255,.05);border:2px solid rgba(255,215,0,.3);border-radius:20px;padding:20px;margin-bottom:15px}.category-badge{display:inline-block;padding:5px 15px;background:rgba(255,215,0,.2);border-radius:20px;font-size:.85em;color:#ffd700;margin-bottom:12px}.question{font-size:1.2em;margin-bottom:20px;line-height:1.4}.answers{display:grid;grid-template-columns:1fr 1fr;gap:10px}@media(max-width:500px){.answers{grid-template-columns:1fr}}.answer-btn{padding:14px;font-size:1em;border:2px solid rgba(255,255,255,.3);border-radius:12px;background:rgba(255,255,255,.05);color:#fff;cursor:pointer;text-align:center}.answer-btn:hover:not(:disabled){background:rgba(255,215,0,.2);border-color:#ffd700}.answer-btn.selected{background:rgba(108,92,231,.4);border-color:#6c5ce7}.answer-btn.correct{background:rgba(0,184,148,.7)!important;border-color:#00b894!important;box-shadow:0 0 20px rgba(0,184,148,.5)}.answer-btn.wrong{background:rgba(214,48,49,.7)!important;border-color:#d63031!important}.answer-btn:disabled{cursor:not-allowed}.answer-status{text-align:center;padding:12px;margin-top:15px;border-radius:10px;font-weight:700;display:none}.answer-status.show{display:block}.answer-status.waiting{background:rgba(108,92,231,.3);color:#a29bfe}.answer-status.correct{background:rgba(0,184,148,.3);color:#55efc4}.answer-status.wrong{background:rgba(214,48,49,.3);color:#ff7675}.answer-status.timeout{background:rgba(253,203,110,.3);color:#fdcb6e}.live-players{background:rgba(255,255,255,.05);border-radius:15px;padding:12px}.live-players h3{font-size:.9em;margin-bottom:10px;display:flex;align-items:center;gap:8px}.live-dot{width:8px;height:8px;background:#e74c3c;border-radius:50%;animation:blink 1.5s infinite}@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}.players-grid{display:flex;flex-wrap:wrap;gap:6px}.player-chip{display:flex;align-items:center;gap:4px;padding:4px 10px;background:rgba(255,255,255,.1);border-radius:12px;font-size:.8em}.player-chip.dead{opacity:.4;text-decoration:line-through}.player-chip.is-me{border:2px solid #ffd700;background:rgba(255,215,0,.2)}.player-chip.answered{background:rgba(0,184,148,.3)}#gameover-screen{display:none;text-align:center;padding:30px 20px}.result-icon{font-size:4em;margin-bottom:15px}.final-stats{background:rgba(255,255,255,.1);border-radius:15px;padding:15px;margin-bottom:20px}.stat-row{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid rgba(255,255,255,.1)}.winners-list{background:rgba(255,215,0,.1);border:2px solid rgba(255,215,0,.3);border-radius:15px;padding:15px;margin-bottom:20px}.winners-list h3{color:#ffd700;margin-bottom:12px}.winner-item{display:flex;justify-content:space-between;padding:8px 12px;background:rgba(255,255,255,.05);border-radius:8px;margin-bottom:6px}#eliminated-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.9);display:none;justify-content:center;align-items:center;z-index:200;flex-direction:column;gap:15px}#eliminated-overlay .skull{font-size:5em}#eliminated-overlay h2{color:#d63031}.connection-status{position:fixed;top:10px;right:10px;padding:5px 10px;border-radius:12px;font-size:.75em;background:rgba(0,0,0,.5)}.connection-status.connected{color:#00b894}.error-msg{color:#e74c3c;font-size:.9em;margin-top:10px}
    </style>
</head>
<body>
    <div class="connection-status" id="connection-status">Verbinde...</div>
    <div class="container">
        <h1>üéØ Wer √ºberlebt? - Konnektoren</h1>
        <div id="login-screen"><div class="logo">üéØ</div><h2>30 Fragen ‚Ä¢ 3 Leben ‚Ä¢ 15 Sekunden<br><small style="color:#aaa">dass, weil, denn, trotzdem, wenn, als</small></h2><div class="input-group"><input type="text" id="player-name" placeholder="Dein Name" maxlength="15"><input type="text" id="game-code" class="code-input" placeholder="CODE" maxlength="4"></div><button class="btn-primary" id="join-btn">üö™ Beitreten</button><div class="divider"><span>oder</span></div><button class="btn-secondary" id="create-btn">üëë Neues Spiel erstellen</button><div class="error-msg" id="error-msg"></div></div>
        <div id="lobby-screen"><div class="lobby-box"><h2>‚è≥ Warteraum</h2><div class="lobby-code" id="lobby-code">CODE</div><p style="color:#888;font-size:.85em">Teile diesen Code</p><div class="waiting-players" id="waiting-players"></div><div id="host-controls"><button class="start-game-btn" id="start-btn" disabled>‚ñ∂Ô∏è SPIEL STARTEN</button><p style="color:#00b894;font-size:.85em">üëë Du bist der Spielleiter</p><div><button class="small-btn danger" id="clear-btn">üóëÔ∏è Alle entfernen</button><button class="small-btn danger" id="reset-btn">üîÑ Zur√ºcksetzen</button></div></div><div id="player-controls" style="display:none"><p style="color:#fdcb6e">‚è≥ Warte auf Spielleiter...</p></div></div></div>
        <div id="game-screen"><div class="game-header"><div class="player-info"><span class="player-name" id="display-name"></span><span class="lives" id="display-lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></div><div class="timer" id="timer">15</div><div class="progress-info"><div class="question-num" id="question-num">1/30</div><div class="survivors" id="survivors">üë• 0</div></div></div><div class="quiz-section"><div class="category-badge" id="category"></div><div class="question" id="question"></div><div class="answers" id="answers"></div><div class="answer-status" id="answer-status"></div></div><div class="live-players"><h3><span class="live-dot"></span> Spieler</h3><div class="players-grid" id="players-grid"></div></div></div>
        <div id="gameover-screen"><div class="result-icon" id="result-icon">üèÜ</div><h2 id="result-title">Spiel beendet!</h2><p id="result-message" style="color:#aaa;margin-bottom:20px"></p><div class="final-stats"><div class="stat-row"><span>Richtig</span><span id="stat-correct">0</span></div><div class="stat-row"><span>Falsch</span><span id="stat-wrong">0</span></div><div class="stat-row"><span>Leben</span><span id="stat-lives">0</span></div></div><div class="winners-list"><h3>üèÜ √úberlebende</h3><div id="winners-content"></div></div><button class="btn-primary" id="back-btn">üè† Zur√ºck</button></div>
        <div id="eliminated-overlay"><div class="skull">üíÄ</div><h2>Ausgeschieden!</h2><p style="color:#aaa">Du kannst weiter zuschauen</p><button class="btn-secondary" id="watch-btn">üëÄ Zuschauen</button></div>
    </div>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded',function(){firebase.initializeApp({apiKey:"AIzaSyBDChXlm34Kr7Gg0Dw458GiiwoLnWJAnxM",authDomain:"lern-deutsch-arash.firebaseapp.com",databaseURL:"https://lern-deutsch-arash-default-rtdb.europe-west1.firebasedatabase.app",projectId:"lern-deutsch-arash"});const db=firebase.database();
    const questions=[{cat:"dass",q:"Ich hoffe, ___ du morgen kommst.",a:["dass","weil","denn","wenn"],c:0},{cat:"dass",q:"Er sagt, ___ er keine Zeit hat.",a:["dass","weil","trotzdem","denn"],c:0},{cat:"dass",q:"Ich wei√ü, ___ das schwer ist.",a:["dass","wenn","als","denn"],c:0},{cat:"dass",q:"Es ist wichtig, ___ du p√ºnktlich bist.",a:["dass","weil","denn","trotzdem"],c:0},{cat:"dass",q:"Ich glaube, ___ er recht hat.",a:["dass","wenn","weil","als"],c:0},{cat:"weil",q:"Ich bleibe zu Hause, ___ ich krank bin.",a:["weil","dass","denn","trotzdem"],c:0},{cat:"weil",q:"Sie ist m√ºde, ___ sie lange gearbeitet hat.",a:["weil","dass","wenn","als"],c:0},{cat:"weil",q:"Er lernt Deutsch, ___ er in Deutschland arbeiten will.",a:["weil","denn","dass","trotzdem"],c:0},{cat:"weil",q:"Ich kann nicht kommen, ___ ich einen Termin habe.",a:["weil","dass","denn","wenn"],c:0},{cat:"weil",q:"Sie weint, ___ sie traurig ist.",a:["weil","dass","trotzdem","als"],c:0},{cat:"denn",q:"Ich gehe nicht raus, ___ es regnet.",a:["denn","weil","dass","trotzdem"],c:0},{cat:"denn",q:"Er isst nichts, ___ er hat keinen Hunger.",a:["denn","weil","dass","wenn"],c:0},{cat:"denn",q:"Sie kommt sp√§ter, ___ sie muss noch arbeiten.",a:["denn","weil","dass","als"],c:0},{cat:"denn",q:"Ich helfe dir, ___ du bist mein Freund.",a:["denn","weil","dass","trotzdem"],c:0},{cat:"denn",q:"Wir fahren mit dem Bus, ___ das Auto ist kaputt.",a:["denn","weil","dass","wenn"],c:0},{cat:"trotzdem",q:"Es regnet. ___ gehe ich spazieren.",a:["Trotzdem","Weil","Dass","Denn"],c:0},{cat:"trotzdem",q:"Er ist m√ºde. ___ arbeitet er weiter.",a:["Trotzdem","Weil","Wenn","Denn"],c:0},{cat:"trotzdem",q:"Ich habe Kopfschmerzen. ___ gehe ich zur Arbeit.",a:["Trotzdem","Dass","Weil","Als"],c:0},{cat:"trotzdem",q:"Das Essen ist teuer. ___ kaufe ich es.",a:["Trotzdem","Denn","Weil","Wenn"],c:0},{cat:"trotzdem",q:"Sie hat wenig Zeit. ___ hilft sie mir.",a:["Trotzdem","Dass","Weil","Denn"],c:0},{cat:"wenn",q:"___ du kommst, freue ich mich.",a:["Wenn","Als","Dass","Weil"],c:0},{cat:"wenn",q:"___ es regnet, bleibe ich zu Hause.",a:["Wenn","Als","Denn","Trotzdem"],c:0},{cat:"wenn",q:"Ich rufe dich an, ___ ich fertig bin.",a:["wenn","als","dass","denn"],c:0},{cat:"wenn",q:"___ ich Zeit habe, lese ich gern.",a:["Wenn","Als","Weil","Dass"],c:0},{cat:"wenn",q:"Er wird gl√ºcklich sein, ___ er das h√∂rt.",a:["wenn","als","denn","trotzdem"],c:0},{cat:"als",q:"___ ich ein Kind war, wohnte ich in Berlin.",a:["Als","Wenn","Weil","Dass"],c:0},{cat:"als",q:"___ er ankam, war es schon dunkel.",a:["Als","Wenn","Denn","Trotzdem"],c:0},{cat:"als",q:"Ich war traurig, ___ du gegangen bist.",a:["als","wenn","dass","weil"],c:0},{cat:"als",q:"___ ich jung war, spielte ich Fu√üball.",a:["Als","Wenn","Weil","Denn"],c:0},{cat:"als",q:"Sie hat geweint, ___ sie den Film gesehen hat.",a:["als","wenn","dass","trotzdem"],c:0}];
    let gameCode,playerId,playerName,isHost=false,lives=3,correct=0,wrong=0,currentQ=-1,answered=false,selected=null,timerInt=null,watching=false,gameRef,playersRef,allPlayers=[],evaluating=false;
    db.ref(".info/connected").on("value",s=>{const el=document.getElementById("connection-status");el.textContent=s.val()?"üü¢ Online":"üî¥ Offline";el.className="connection-status "+(s.val()?"connected":"disconnected")});
    function genCode(){const c="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";return Array(4).fill(0).map(()=>c[Math.floor(Math.random()*c.length)]).join('')}
    function showError(m){document.getElementById("error-msg").textContent=m;setTimeout(()=>document.getElementById("error-msg").textContent="",3000)}
    document.getElementById("create-btn").onclick=createGame;document.getElementById("join-btn").onclick=joinGame;document.getElementById("start-btn").onclick=startGame;
    document.getElementById("clear-btn").onclick=()=>{if(confirm("Alle entfernen?"))playersRef.once("value",s=>s.forEach(c=>{if(c.key!==playerId)playersRef.child(c.key).remove()}))};
    document.getElementById("reset-btn").onclick=resetGame;document.getElementById("back-btn").onclick=backToHome;
    document.getElementById("watch-btn").onclick=()=>{watching=true;document.getElementById("eliminated-overlay").style.display="none"};
    document.getElementById("game-code").onkeypress=e=>{if(e.key==="Enter")joinGame()};
    function createGame(){playerName=document.getElementById("player-name").value.trim();if(!playerName){showError("Name eingeben!");return}gameCode=genCode();playerId="host_"+Date.now();isHost=true;gameRef=db.ref("konnektoren/"+gameCode);playersRef=db.ref("konnektoren/"+gameCode+"/players");gameRef.remove().then(()=>gameRef.set({status:"lobby",currentQuestion:-1,questionStart:null,host:playerId})).then(()=>playersRef.child(playerId).set({name:playerName,lives:3,isHost:true,answered:false})).then(()=>{playersRef.child(playerId).onDisconnect().remove();showLobby();setupListeners()})}
    function joinGame(){playerName=document.getElementById("player-name").value.trim();gameCode=document.getElementById("game-code").value.trim().toUpperCase();if(!playerName){showError("Name eingeben!");return}if(!gameCode||gameCode.length!==4){showError("4-stelliger Code!");return}playerId="p_"+Date.now()+"_"+Math.random().toString(36).substr(2,4);isHost=false;gameRef=db.ref("konnektoren/"+gameCode);playersRef=db.ref("konnektoren/"+gameCode+"/players");gameRef.once("value").then(s=>{if(!s.exists()){showError("Spiel nicht gefunden!");return Promise.reject()}if(s.val().status!=="lobby"){showError("Spiel l√§uft bereits!");return Promise.reject()}return playersRef.child(playerId).set({name:playerName,lives:3,isHost:false,answered:false})}).then(()=>{playersRef.child(playerId).onDisconnect().remove();showLobby();setupListeners()}).catch(()=>{})}
    function showLobby(){document.getElementById("login-screen").style.display="none";document.getElementById("lobby-screen").style.display="block";document.getElementById("lobby-code").textContent=gameCode;document.getElementById("host-controls").style.display=isHost?"block":"none";document.getElementById("player-controls").style.display=isHost?"none":"block"}
    function setupListeners(){playersRef.on("value",snap=>{const players=[];snap.forEach(c=>{const d=c.val();if(d&&d.name)players.push({id:c.key,...d})});allPlayers=players;updatePlayers(players);checkAllAnswered()});gameRef.on("value",snap=>{const game=snap.val();if(!game){backToHome();return}if(game.status==="playing"){document.getElementById("lobby-screen").style.display="none";document.getElementById("game-screen").style.display="block";if(game.currentQuestion!==currentQ){currentQ=game.currentQuestion;evaluating=false;showQuestion(game.questionStart)}}else if(game.status==="finished"){endGame()}})}
    function updatePlayers(players){const w=document.getElementById("waiting-players");w.innerHTML=players.length===0?'<p style="color:#666">Warte...</p>':players.map(p=>`<div class="waiting-player"><span>${p.name} ${p.isHost?'üëë':''}</span>${isHost&&!p.isHost?`<button class="remove-btn" onclick="event.stopPropagation();firebase.database().ref('konnektoren/${gameCode}/players/${p.id}').remove()">‚úï</button>`:''}</div>`).join("");document.getElementById("start-btn").disabled=players.filter(p=>!p.isHost).length===0;document.getElementById("survivors").textContent=`üë• ${players.filter(p=>p.lives>0).length}`;document.getElementById("players-grid").innerHTML=players.map(p=>`<div class="player-chip ${p.lives===0?'dead':''} ${p.id===playerId?'is-me':''} ${p.answered&&p.lives>0?'answered':''}"><span>${p.name}</span><span>${p.lives>0?'‚ù§Ô∏è'.repeat(p.lives):'üíÄ'}</span></div>`).join("")}
    function checkAllAnswered(){if(evaluating||currentQ<0)return;const alive=allPlayers.filter(p=>p.lives>0);if(alive.length>0&&alive.every(p=>p.answered)){evaluating=true;if(timerInt)clearInterval(timerInt);evaluate()}}
    function resetGame(){if(!confirm("Zur√ºcksetzen?"))return;gameRef.update({status:"lobby",currentQuestion:-1,questionStart:null});playersRef.once("value",s=>s.forEach(c=>playersRef.child(c.key).update({lives:3,answered:false})));lives=3;correct=0;wrong=0;currentQ=-1;watching=false;evaluating=false;["game-screen","gameover-screen","eliminated-overlay"].forEach(id=>document.getElementById(id).style.display="none");document.getElementById("lobby-screen").style.display="block"}
    function startGame(){if(!isHost)return;playersRef.once("value",s=>{s.forEach(c=>playersRef.child(c.key).update({answered:false}));gameRef.update({status:"playing",currentQuestion:0,questionStart:Date.now()})})}
    function showQuestion(startTime){if(currentQ>=questions.length){gameRef.update({status:"finished"});return}answered=false;selected=null;playersRef.child(playerId).update({answered:false});const q=questions[currentQ];document.getElementById("display-name").textContent=playerName;document.getElementById("question-num").textContent=`${currentQ+1}/${questions.length}`;document.getElementById("category").textContent=q.cat;document.getElementById("question").textContent=q.q;updateLives();
    // SHUFFLE
    const idx=[0,1,2,3];for(let i=idx.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[idx[i],idx[j]]=[idx[j],idx[i]]}
    const ans=document.getElementById("answers");ans.innerHTML="";idx.forEach(origIdx=>{const btn=document.createElement("button");btn.className="answer-btn";btn.textContent=q.a[origIdx];btn.dataset.origIdx=origIdx;btn.onclick=()=>selectAnswer(btn,origIdx);if(watching||lives===0)btn.disabled=true;ans.appendChild(btn)});document.getElementById("answer-status").className="answer-status";startTimer(startTime)}
    function selectAnswer(btn,idx){if(answered||lives===0)return;answered=true;selected=idx;document.querySelectorAll(".answer-btn").forEach(b=>{b.disabled=true;b.classList.remove("selected")});btn.classList.add("selected");playersRef.child(playerId).update({answered:true});const st=document.getElementById("answer-status");st.className="answer-status waiting show";st.textContent="‚úì Warte auf andere..."}
    function startTimer(startTime){if(timerInt)clearInterval(timerInt);const el=document.getElementById("timer");function tick(){const rem=Math.max(0,15-Math.floor((Date.now()-startTime)/1000));el.textContent=rem;el.className="timer"+(rem<=3?" danger":rem<=5?" warning":"");if(rem===0){clearInterval(timerInt);if(!evaluating){evaluating=true;evaluate()}}}tick();timerInt=setInterval(tick,200)}
    function evaluate(){const q=questions[currentQ];const st=document.getElementById("answer-status");document.querySelectorAll(".answer-btn").forEach(btn=>{btn.disabled=true;if(parseInt(btn.dataset.origIdx)===q.c)btn.classList.add("correct")});if(!answered){if(lives>0){lives--;wrong++;playersRef.child(playerId).update({lives})}st.className="answer-status timeout show";st.textContent="‚è∞ Zeit abgelaufen!"}else if(selected===q.c){correct++;st.className="answer-status correct show";st.textContent="‚úÖ Richtig!"}else{if(lives>0){lives--;playersRef.child(playerId).update({lives})}wrong++;document.querySelectorAll(".answer-btn").forEach(btn=>{if(parseInt(btn.dataset.origIdx)===selected)btn.classList.add("wrong")});st.className="answer-status wrong show";st.textContent=lives>0?`‚ùå Falsch! Noch ${lives} Leben`:"‚ùå Falsch!"}updateLives();if(lives===0&&!watching)setTimeout(()=>{document.getElementById("eliminated-overlay").style.display="flex"},1000);if(isHost)setTimeout(()=>{playersRef.once("value",s=>{s.forEach(c=>playersRef.child(c.key).update({answered:false}));if(currentQ+1>=questions.length)gameRef.update({status:"finished"});else gameRef.update({currentQuestion:currentQ+1,questionStart:Date.now()})})},3000)}
    function updateLives(){document.getElementById("display-lives").textContent=lives>0?"‚ù§Ô∏è".repeat(lives)+"üñ§".repeat(3-lives):"üíÄ"}
    function endGame(){if(timerInt)clearInterval(timerInt);["game-screen","eliminated-overlay"].forEach(id=>document.getElementById(id).style.display="none");document.getElementById("gameover-screen").style.display="block";document.getElementById("result-icon").textContent=lives>0?"üèÜ":"üíÄ";document.getElementById("result-title").textContent=lives>0?"Du hast √ºberlebt!":"Ausgeschieden!";document.getElementById("result-message").textContent=lives>0?"Gl√ºckwunsch!":"N√§chstes Mal!";document.getElementById("stat-correct").textContent=correct;document.getElementById("stat-wrong").textContent=wrong;document.getElementById("stat-lives").textContent=lives>0?"‚ù§Ô∏è".repeat(lives):"üíÄ";playersRef.once("value",s=>{const winners=[];s.forEach(c=>{const p=c.val();if(p&&p.lives>0)winners.push(p)});document.getElementById("winners-content").innerHTML=winners.length===0?"<p>Niemand √ºberlebt! üíÄ</p>":winners.map(w=>`<div class="winner-item"><span>${w.name}</span><span>${"‚ù§Ô∏è".repeat(w.lives)}</span></div>`).join("")})}
    function backToHome(){if(timerInt)clearInterval(timerInt);if(gameRef)gameRef.off();if(playersRef){playersRef.off();if(playerId)playersRef.child(playerId).remove()}gameCode=playerId=null;isHost=false;lives=3;correct=0;wrong=0;currentQ=-1;watching=false;evaluating=false;["lobby-screen","game-screen","gameover-screen","eliminated-overlay"].forEach(id=>document.getElementById(id).style.display="none");document.getElementById("login-screen").style.display="flex";document.getElementById("game-code").value=""}});
    </script>
    <script data-goatcounter="https://aguitoo.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</body>
</html>
